# Bonus Engine

Система лояльности для ресторанов и кафе с интеграцией в кассовые системы через Telegram WebApp.

## О проекте

Bonus Engine решает проблему низкой клиентской лояльности в сфере HoReCa через современный подход к программе лояльности. Вместо традиционных пластиковых карт клиенты используют QR-код в Telegram, а кассиры сканируют его для автоматического начисления баллов.

**Ключевая идея**: Простота для клиента, автоматизация для бизнеса.

## Техническая архитектура

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Telegram Bot  │    │   FastAPI       │    │   PostgreSQL    │
│                 │    │   Backend       │    │   Database      │
│  - WebApp UI    │◄──►│  - REST API     │◄──►│  - Users        │
│  - QR Display   │    │  - Webhooks     │    │  - Transactions │
│  - PWA Support  │    │  - Auth         │    │  - Points       │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │
         │                       │
         ▼                       ▼
┌─────────────────┐    ┌─────────────────┐
│   POS System    │    │   Admin Panel   │
│   Integration   │    │   (Future)      │
│   via Webhooks  │    │                 │
└─────────────────┘    └─────────────────┘
```

## Технологический стек

### Backend
- **FastAPI** - веб-фреймворк
- **SQLAlchemy 2.0** - ORM с async/await 
- **PostgreSQL** - реляционная БД
- **Alembic** - миграции схемы БД
- **Pydantic** - валидация и сериализация данных

### Bot & Frontend
- **Aiogram 3.x** - библиотека для Telegram Bot API
- **Vanilla JavaScript** - без фреймворков для максимальной производительности
- **Telegram WebApp API** - нативная интеграция с Telegram
- **PWA** - возможность добавления на главный экран

### DevOps
- **Uvicorn** - ASGI сервер для продакшена
- **Nginx** - реверс-прокси и статика
- **Systemd** - управление сервисами
- **SSL/TLS** - безопасность соединений

## Ключевые особенности

### Для клиентов
- **Простота**: Один QR-код вместо множества карт
- **Удобство**: Все в привычном Telegram
- **Прозрачность**: История всех транзакций и баллов
- **Мобильность**: Работает на любом устройстве

### Для бизнеса
- **Автоматизация**: Интеграция с кассовыми системами
- **Аналитика**: Отчеты по клиентской активности
- **Гибкость**: Настраиваемые правила начисления баллов
- **Масштабируемость**: Готовность к росту нагрузки

### Технические решения
- **Async/await** - высокая производительность при множественных запросах
- **Вебхуки** - надежная интеграция с внешними системами
- **Валидация данных** - защита от некорректных запросов
- **Миграции БД** - безопасное обновление схемы

## Структура проекта

```
bonus-engine/
├── backend/                 # FastAPI приложение
│   ├── app/
│   │   ├── api/            # REST API эндпоинты
│   │   ├── config/         # Конфигурация приложения
│   │   ├── database/       # Подключение к БД
│   │   ├── repository/     # Слой доступа к данным
│   │   ├── schemas/        # Pydantic модели
│   │   └── tables/         # SQLAlchemy модели
│   ├── alembic/            # Миграции базы данных
│   └── main.py             # Точка входа приложения
├── bot/                    # Telegram бот
│   ├── handlers/           # Обработчики команд
│   └── main.py             # Точка входа бота
├── frontend/               # WebApp интерфейс
│   ├── public/             # Статические ресурсы
│   ├── index.html          # Главная страница
│   ├── app.js              # Бизнес-логика
│   └── manifest.json       # PWA конфигурация
└── requirements.txt         # Python зависимости
```

## Установка и запуск

### Локальная разработка

1. **Клонирование и настройка окружения**
```bash
git clone <repository-url>
cd bonus-engine
python -m venv venv
source venv/bin/activate  # Linux/Mac
pip install -r requirements.txt
```

2. **Настройка базы данных**
```bash
# Создание PostgreSQL БД
createdb bonus_engine_db

# Настройка переменных окружения
cp env.example .env
# Отредактируйте .env с вашими настройками БД
```

3. **Запуск миграций**
```bash
cd backend
alembic upgrade head
```

4. **Запуск сервисов**
```bash
# Backend API
cd backend && uvicorn main:app --reload

# Telegram Bot
cd bot && python main.py

# Frontend (откройте index.html в браузере)
```

### Продакшен деплой

Подробное руководство по деплою на сервер доступно в [DEPLOY.md](DEPLOY.md).

## API документация

После запуска backend доступна автоматическая документация:
- **Swagger UI**: `http://localhost:8000/docs`
- **ReDoc**: `http://localhost:8000/redoc`

### Основные эндпоинты

- `POST /users/init/` - регистрация нового пользователя
- `POST /users/profile` - получение профиля пользователя
- `POST /transactions/` - создание транзакции
- `GET /transactions/history` - история транзакций
- `POST /webhook/transaction` - вебхук для интеграции с кассой

## Лицензия

MIT License - свободное использование для коммерческих и некоммерческих проектов.

---

**Автор**: Niko-MM  
**Версия**: 1.0.0
